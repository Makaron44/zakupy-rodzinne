<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    <title>Nawigator Rzeczywistoci</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script crossorigin="anonymous" src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .safe-bottom { padding-bottom: calc(6rem + env(safe-area-inset-bottom)); }
        .safe-top { padding-top: max(1rem, env(safe-area-inset-top)); }
        .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        input, textarea, select { font-size: 16px !important; }
        
        /* Debugger na ekranie */
        #error-console { display: none; position: fixed; top: 0; left: 0; right: 0; padding: 20px; background: #450a0a; color: #fca5a5; font-family: monospace; font-size: 12px; z-index: 99999; border-bottom: 2px solid red; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="error-console"></div>
    <div id="root">
        <div style="height: 100vh; display:flex; align-items:center; justify-content:center; color:#475569;">
            adowanie aplikacji...
        </div>
    </div>

    <script>
        window.onerror = function(msg, url, line, col, error) {
            var consoleDiv = document.getElementById('error-console');
            consoleDiv.style.display = 'block';
            consoleDiv.innerHTML += "BD: " + msg + "\nLinia: " + line + "\nURL: " + url + "\n\n";
            // Pr贸ba wymuszenia odwie偶enia cache jeli to bd adowania
            if(msg.toLowerCase().includes('script error')) {
                consoleDiv.innerHTML += "WSKAZWKA: To mo偶e by wina starej pamici podrcznej.\nSpr贸buj otworzy stron w trybie PRYWATNYM.";
            }
            return false;
        };
    </script>

    <script type="text/babel" data-presets="env,react">
        
        // Sprawdzenie czy React si zaadowa
        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
            throw new Error("Biblioteki React nie zostay zaadowane. Sprawd藕 cze.");
        }

        const { useState, useEffect, useMemo } = React;
        const { createRoot } = ReactDOM;

        // IKONY
        const Icon = ({ path, color = "currentColor", size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Shield: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />,
            Book: <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />,
            Pen: <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />,
            Trend: <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" />,
            Alert: <circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" />,
            Plus: <circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="16" /><line x1="8" y1="12" x2="16" y2="12" />,
            Trash: <polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />,
            Settings: <circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />,
            X: <line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />,
            Search: <circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" />,
            Send: <line x1="22" y1="2" x2="11" y2="13" /><polygon points="22 2 15 22 11 13 2 9 22 2" />,
            Key: <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4" />
        };

        const SimpleChart = ({ data }) => {
            if (!data || data.length === 0) return <div className="h-full flex items-center justify-center text-slate-500 text-xs">Brak danych</div>;
            const height = 150, width = 300, padding = 20, maxVal = 5;
            
            const points = data.map((d, i) => {
                const x = padding + (i / (data.length - 1 || 1)) * (width - 2 * padding);
                const y = height - padding - (d.energy / maxVal) * (height - 2 * padding);
                return `${x},${y}`;
            }).join(" ");
            
            const areaPoints = `${points} ${width-padding},${height-padding} ${padding},${height-padding}`;

            return (
                <div className="w-full h-full flex flex-col">
                    <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full overflow-visible">
                        <line x1={padding} y1={height-padding} x2={width-padding} y2={height-padding} stroke="#334155" strokeWidth="1" />
                        <line x1={padding} y1={padding} x2={padding} y2={height-padding} stroke="#334155" strokeWidth="1" />
                        <defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#a855f7" stopOpacity="0.4"/><stop offset="100%" stopColor="#a855f7" stopOpacity="0"/></linearGradient></defs>
                        <polygon points={areaPoints} fill="url(#g)" />
                        <polyline points={points} fill="none" stroke="#a855f7" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />
                        {data.map((d, i) => {
                            const x = padding + (i / (data.length - 1 || 1)) * (width - 2 * padding);
                            const y = height - padding - (d.energy / maxVal) * (height - 2 * padding);
                            return <g key={i}><circle cx={x} cy={y} r="3" fill="#fff" /><text x={x} y={height} fill="#94a3b8" fontSize="10" textAnchor="middle">{d.date.split('.')[0]}</text></g>
                        })}
                    </svg>
                </div>
            );
        };

        const Kategoria = { SOS: " SOS", SLAJD: " SLAJD", ZASADA: " ZASADA" };
        const HOOK_OPTIONS = ['Aplikacja Paliwowa', 'Szef', 'Korek', 'Lk', 'Inny Kierowca', 'Zmczenie', 'Inne'];
        const INITIAL_PERELKI = [
            { id: "1", kategoria: Kategoria.SOS, tytul: "Presja Czasu", trescPorady: "Zejd藕 z linii ciosu. To tylko cyfry na ekranie.", afirmacjaSkrot: "M贸j wiat dba o m贸j spok贸j." },
            { id: "2", kategoria: Kategoria.SLAJD, tytul: "Bezpieczna Trasa", trescPorady: "Widzisz zielone wiata i pust drog.", afirmacjaSkrot: "Pyn w Prdzie Wariant贸w." }
        ];

        // Bezpieczny odczyt JSON
        const safeJSON = (key, fallback) => {
            try { 
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : fallback;
            } catch (e) { return fallback; }
        };

        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [apiKey, setApiKey] = useState(() => localStorage.getItem('nr_api_key') || "");
            const [journal, setJournal] = useState(() => safeJSON('nr_journal', []));
            const [amalgam, setAmalgam] = useState(() => localStorage.getItem('nr_amalgam') || "");
            const [pearls, setPearls] = useState(() => safeJSON('nr_pearls', INITIAL_PERELKI));
            
            const [isAddingJournal, setIsAddingJournal] = useState(false);
            const [isAddingPearl, setIsAddingPearl] = useState(false);
            const [isBusy, setIsBusy] = useState(false);
            const [challenge, setChallenge] = useState("");
            const [journalSearch, setJournalSearch] = useState("");
            
            const [newPearlCategory, setNewPearlCategory] = useState(Kategoria.ZASADA);
            const [newPearlTytul, setNewPearlTytul] = useState("");
            const [newPearlTresc, setNewPearlTresc] = useState("");
            const [newPearlAfirmacja, setNewPearlAfirmacja] = useState("");

            useEffect(() => { localStorage.setItem('nr_journal', JSON.stringify(journal)); }, [journal]);
            useEffect(() => { localStorage.setItem('nr_pearls', JSON.stringify(pearls)); }, [pearls]);
            useEffect(() => { localStorage.setItem('nr_amalgam', amalgam); }, [amalgam]);
            useEffect(() => { localStorage.setItem('nr_api_key', apiKey); }, [apiKey]);

            const handleDeletePearl = (e, id) => {
                e.preventDefault(); e.stopPropagation();
                if (window.confirm('Usun t perek trwale?')) {
                    setPearls(prev => prev.filter(p => String(p.id) !== String(id)));
                }
            };

            const handleAddPearl = (e) => {
                e.preventDefault();
                const newPearl = { id: String(Date.now()), kategoria: newPearlCategory, tytul: newPearlTytul, trescPorady: newPearlTresc, afirmacjaSkrot: newPearlAfirmacja };
                setPearls([newPearl, ...pearls]);
                setIsAddingPearl(false);
                setNewPearlTytul(""); setNewPearlTresc(""); setNewPearlAfirmacja("");
            };

            const handleAddJournal = (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const entry = {
                    id: String(Date.now()), timestamp: Date.now(),
                    energia: Number(fd.get('energia')), haczyk: fd.get('haczyk'),
                    reakcja: fd.get('reakcja'), wniosek: fd.get('wniosek')
                };
                setJournal([entry, ...journal]);
                setIsAddingJournal(false);
            };

            const handleAmalgam = async () => {
                if (!challenge) return;
                if (!apiKey || apiKey.length < 5) { alert("Wprowad藕 klucz API w ustawieniach!"); setActiveTab('settings'); return; }
                setIsBusy(true);
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: `Jeste Vadimem Zelandem. Stw贸rz kr贸tki Amalgamat (1 zdanie) na problem: "${challenge}".` }] }] })
                    });
                    if(!response.ok) throw new Error("Bd API: " + response.status);
                    const data = await response.json();
                    const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "Bd generowania.";
                    setAmalgam(text);
                } catch (e) { alert("Bd API: " + e.message); }
                setIsBusy(false);
                setChallenge("");
            };

            const chartData = useMemo(() => {
                const dates = [];
                for (let i = 6; i >= 0; i--) {
                    const d = new Date(); d.setDate(d.getDate() - i);
                    dates.push(d.toLocaleDateString('pl-PL', { day: '2-digit', month: '2-digit' }));
                }
                return dates.map(dateStr => {
                    const entries = journal.filter(j => new Date(j.timestamp).toLocaleDateString('pl-PL', { day: '2-digit', month: '2-digit' }) === dateStr);
                    const avg = entries.length ? entries.reduce((s, c) => s + c.energia, 0) / entries.length : 0;
                    return { date: dateStr, energy: parseFloat(avg.toFixed(1)) };
                });
            }, [journal]);

            const getPearlStyles = (cat) => {
                if (cat === Kategoria.SOS) return { color: 'text-red-400', border: 'border-red-500/20', bg: 'bg-red-500/5', icon: Icons.Alert };
                if (cat === Kategoria.SLAJD) return { color: 'text-purple-400', border: 'border-purple-500/20', bg: 'bg-purple-500/5', icon: Icons.Trend };
                return { color: 'text-blue-400', border: 'border-blue-500/20', bg: 'bg-blue-500/5', icon: Icons.Book };
            };

            return (
                <div className="min-h-screen max-w-lg mx-auto flex flex-col safe-top relative pb-24">
                    <header className="px-6 py-4 flex justify-between items-center sticky top-0 z-30 backdrop-blur-md bg-[#0f172a]/70">
                        <div>
                            <h1 className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">Nawigator</h1>
                            <p className="text-[10px] text-slate-500 font-bold uppercase tracking-widest italic">Reality Transurfing</p>
                        </div>
                        <button onClick={() => setActiveTab('settings')} className={`p-3 glass rounded-2xl active:scale-95 transition-all ${activeTab === 'settings' ? 'border-blue-500 bg-blue-500/10' : ''}`}>
                            <Icon path={Icons.Settings} className={activeTab === 'settings' ? 'text-blue-400' : 'text-slate-400'} size={20}/>
                        </button>
                    </header>

                    <main className="flex-1 px-4 space-y-6 overflow-x-hidden safe-bottom">
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6 animate-slide-up">
                                <section className="space-y-3">
                                    <h2 className="text-sm font-bold text-emerald-400 flex items-center gap-2 px-1">Twoje Nastawienie</h2>
                                    <div className="glass rounded-3xl p-6 bg-gradient-to-br from-emerald-900/20 to-slate-900 border-emerald-500/20 shadow-lg">
                                        {amalgam ? (
                                            <div className="space-y-4 text-center">
                                                <p className="text-xl font-medium italic text-slate-100 leading-relaxed">"{amalgam}"</p>
                                                <button onClick={() => setAmalgam("")} className="text-xs text-slate-500 underline py-2">Nowy cel</button>
                                            </div>
                                        ) : (
                                            <div className="space-y-4">
                                                <p className="text-xs text-slate-400">Co Ci dzi stresuje?</p>
                                                <div className="flex gap-2">
                                                    <input value={challenge} onChange={e => setChallenge(e.target.value)} placeholder="Problem..." className="flex-1 bg-slate-800/50 rounded-2xl px-4 py-3 text-base outline-none border border-slate-700 focus:border-emerald-500" />
                                                    <button onClick={handleAmalgam} disabled={isBusy} className="bg-emerald-600 p-3 rounded-2xl active:scale-95 transition-all text-white">
                                                        {isBusy ? "..." : <Icon path={Icons.Send} size={20}/>}
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </section>

                                <section className="space-y-3">
                                    <div className="flex justify-between items-center px-1">
                                        <h2 className="text-sm font-bold text-red-400 flex items-center gap-2">SOS</h2>
                                        <button onClick={() => { setNewPearlCategory(Kategoria.SOS); setIsAddingPearl(true); }} className="text-slate-400 p-2 rounded-full active:bg-slate-800"><Icon path={Icons.Plus} size={24}/></button>
                                    </div>
                                    <div className="space-y-3">
                                        {pearls.filter(p => p.kategoria === Kategoria.SOS).map(p => (
                                            <div key={p.id} className="glass rounded-2xl p-4 border-l-4 border-red-500 flex justify-between items-center relative overflow-hidden">
                                                <div className="flex-1 pr-4 z-10">
                                                    <h3 className="font-bold text-sm mb-1 text-slate-200">{p.tytul}</h3>
                                                    <p className="text-xs text-slate-400 italic">"{p.trescPorady}"</p>
                                                </div>
                                                <button onClick={(e) => handleDeletePearl(e, p.id)} className="relative z-20 p-3 text-slate-500 hover:text-red-400 bg-slate-800/50 rounded-xl active:scale-90"><Icon path={Icons.Trash} size={18}/></button>
                                            </div>
                                        ))}
                                    </div>
                                </section>
                            </div>
                        )}

                        {activeTab === 'wiedza' && (
                            <div className="space-y-6 animate-slide-up">
                                <div className="flex justify-between items-center px-1">
                                    <h2 className="text-xl font-bold flex items-center gap-2 text-blue-400">Baza Wiedzy</h2>
                                    <button onClick={() => { setNewPearlCategory(Kategoria.ZASADA); setIsAddingPearl(true); }} className="bg-blue-600 p-3 rounded-full shadow-lg active:scale-90 text-white"><Icon path={Icons.Plus} size={24}/></button>
                                    
                                </div>
                                <div className="space-y-4">
                                    {pearls.map(p => {
                                        const s = getPearlStyles(p.kategoria);
                                        return (
                                            <div key={p.id} className={`glass rounded-2xl p-5 border ${s.border} ${s.bg} flex justify-between items-start gap-4 relative`}>
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <span className={s.color}><Icon path={s.icon} size={18}/></span>
                                                        <span className={`text-[10px] font-bold uppercase tracking-wider ${s.color} opacity-80`}>{p.kategoria}</span>
                                                    </div>
                                                    <h3 className="font-bold text-lg text-slate-100">{p.tytul}</h3>
                                                    <p className="text-sm text-slate-400 mt-2 leading-relaxed font-light">"{p.trescPorady}"</p>
                                                    <p className="text-[10px] text-emerald-400 mt-4 font-bold uppercase">{p.afirmacjaSkrot}</p>
                                                </div>
                                                <button onClick={(e) => handleDeletePearl(e, p.id)} className="relative z-20 p-2 text-slate-500 hover:text-red-400 active:scale-90"><Icon path={Icons.Trash} size={20}/></button>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {activeTab === 'dziennik' && (
                            <div className="space-y-4 animate-slide-up">
                                <div className="flex justify-between items-center px-1">
                                    <h2 className="text-xl font-bold flex items-center gap-2 text-emerald-400">Dziennik</h2>
                                    <button onClick={() => setIsAddingJournal(true)} className="bg-emerald-600 p-3 rounded-full shadow-lg active:scale-90 text-white"><Icon path={Icons.Plus} size={24}/></button>
                                </div>
                                <div className="glass rounded-2xl p-4 flex items-center gap-2 bg-slate-900/50 border border-white/5">
                                    <Icon path={Icons.Search} size={16} className="text-slate-500" />
                                    <input value={journalSearch} onChange={e => setJournalSearch(e.target.value)} placeholder="Szukaj..." className="bg-transparent outline-none text-sm flex-1 text-slate-200" />
                                </div>
                                <div className="space-y-4">
                                    {journal.filter(j => j.haczyk.toLowerCase().includes(journalSearch.toLowerCase())).map(j => (
                                        <div key={j.id} className="glass rounded-2xl p-4 border-l-4 border-emerald-500 space-y-3">
                                            <div className="flex justify-between items-center text-[10px] text-slate-500 border-b border-white/5 pb-2">
                                                <span>{new Date(j.timestamp).toLocaleString('pl-PL')}</span>
                                                <span className="font-bold text-emerald-400 text-xs">Energia: {j.energia}/5</span>
                                            </div>
                                            <p className="text-base font-bold text-slate-200">{j.haczyk}</p>
                                            <p className="text-sm text-slate-400 whitespace-pre-wrap">{j.reakcja}</p>
                                            <div className="pt-2 border-t border-white/5 flex justify-between items-center">
                                                <p className="text-xs text-blue-300 italic">Wniosek: {j.wniosek}</p>
                                                <button onClick={() => { if(confirm("Usun?")) setJournal(prev => prev.filter(x => x.id !== j.id)) }} className="text-slate-600 hover:text-red-400"><Icon path={Icons.Trash} size={16}/></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'analiza' && (
                            <div className="space-y-6 animate-slide-up">
                                <h2 className="text-xl font-bold flex items-center gap-2 px-1 text-purple-400">Trend Energii</h2>
                                <div className="glass rounded-3xl p-6 h-64 border-purple-500/10 shadow-lg">
                                    <SimpleChart data={chartData} />
                                </div>
                            </div>
                        )}

                        {activeTab === 'settings' && (
                            <div className="space-y-6 animate-slide-up">
                                <h2 className="text-xl font-bold px-1">Ustawienia</h2>
                                <div className="glass rounded-3xl p-6 space-y-4 border border-blue-500/20">
                                    <div className="flex items-center gap-3 mb-2">
                                        <Icon path={Icons.Key} size={24} className="text-blue-400"/>
                                        <h3 className="text-sm font-bold text-slate-200">Klucz API Gemini AI</h3>
                                    </div>
                                    <input type="password" value={apiKey} onChange={(e) => setApiKey(e.target.value)} placeholder="Wklej klucz..." className="w-full bg-slate-900/80 rounded-xl p-4 border border-slate-700 outline-none text-slate-200 font-mono text-xs" />
                                </div>
                                <div className="glass rounded-3xl p-6 space-y-4">
                                     <h3 className="text-sm font-bold text-slate-200 mb-2">Strefa Niebezpieczna</h3>
                                    <button onClick={() => { if(confirm('RESET DANYCH?')) { localStorage.clear(); window.location.reload(); }}} className="w-full py-4 bg-red-500/10 border border-red-500/20 text-red-400 rounded-2xl font-bold text-sm">RESETUJ APLIKACJ</button>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* --- MODALE --- */}
                    {isAddingPearl && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] flex items-end justify-center sm:items-center p-0 sm:p-4" onClick={() => setIsAddingPearl(false)}>
                            <div className="glass w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] p-6 space-y-5 animate-slide-up bg-[#0f172a]" onClick={e => e.stopPropagation()}>
                                <h3 className="font-bold text-xl text-blue-400">Nowa Pereka</h3>
                                <form onSubmit={handleAddPearl} className="space-y-4">
                                    <select value={newPearlCategory} onChange={e => setNewPearlCategory(e.target.value)} className="w-full bg-slate-800 rounded-2xl p-4 border border-slate-700 text-slate-200">{Object.values(Kategoria).map(c=> <option key={c} value={c}>{c}</option>)}</select>
                                    <input value={newPearlTytul} onChange={e => setNewPearlTytul(e.target.value)} placeholder="Tytu..." className="w-full bg-slate-800 rounded-2xl p-4 border border-slate-700 text-slate-200" required />
                                    <textarea value={newPearlTresc} onChange={e => setNewPearlTresc(e.target.value)} placeholder="Tre..." className="w-full bg-slate-800 rounded-2xl p-4 border border-slate-700 h-20 text-slate-200" required />
                                    <input value={newPearlAfirmacja} onChange={e => setNewPearlAfirmacja(e.target.value)} placeholder="Afirmacja..." className="w-full bg-slate-800 rounded-2xl p-4 border border-slate-700 text-slate-200" required />
                                    <button type="submit" className="w-full py-4 bg-blue-600 rounded-2xl font-bold text-white">ZAPISZ</button>
                                </form>
                            </div>
                        </div>
                    )}
                    
                    {isAddingJournal && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] flex items-end justify-center sm:items-center p-0 sm:p-4" onClick={() => setIsAddingJournal(false)}>
                            <div className="glass w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] p-6 space-y-5 animate-slide-up bg-[#0f172a]" onClick={e => e.stopPropagation()}>
                                <h3 className="font-bold text-xl text-emerald-400">Nowy Wpis</h3>
                                <form onSubmit={handleAddJournal} className="space-y-4">
                                    <input name="energia" type="range" min="1" max="5" defaultValue="3" className="w-full accent-emerald-500 h-2 bg-slate-700 rounded-lg appearance-none" />
                                    <select name="haczyk" className="w-full bg-slate-800 rounded-2xl p-4 border border-slate-700 text-slate-200">{HOOK_OPTIONS.map(o => <option key={o} value={o}>{o}</option>)}</select>
                                    <textarea name="reakcja" placeholder="Reakcja..." className="w-full bg-slate-800 rounded-2xl p-4 border border-slate-700 h-20 text-slate-200" required />
                                    <textarea name="wniosek" placeholder="Wniosek..." className="w-full bg-slate-800 rounded-2xl p-4 border border-slate-700 h-20 text-slate-200" required />
                                    <button type="submit" className="w-full py-4 bg-emerald-600 rounded-2xl font-bold text-white">DODAJ</button>
                                </form>
                            </div>
                        </div>
                    )}

                    <nav className="fixed bottom-0 left-0 right-0 max-w-lg mx-auto glass flex justify-around items-center p-2 pb-6 sm:pb-2 rounded-t-[2rem] safe-bottom z-40 border-t border-white/10 backdrop-blur-xl bg-[#0f172a]/90">
                        <NavBtn active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon={Icons.Shield} label="Dzi" />
                        <NavBtn active={activeTab === 'wiedza'} onClick={() => setActiveTab('wiedza')} icon={Icons.Book} label="Baza" />
                        <NavBtn active={activeTab === 'dziennik'} onClick={() => setActiveTab('dziennik')} icon={Icons.Pen} label="Log" />
                        <NavBtn active={activeTab === 'analiza'} onClick={() => setActiveTab('analiza')} icon={Icons.Trend} label="Trend" />
                    </nav>
                </div>
            );
        }

        const NavBtn = ({ active, onClick, icon, label }) => (
            <button onClick={onClick} className={`flex flex-col items-center gap-1 p-2 rounded-xl transition-all duration-300 ${active ? 'text-blue-400 bg-blue-500/10 -translate-y-2' : 'text-slate-500'}`}>
                <Icon path={icon} size={22} strokeWidth={active ? 2.5 : 2} />
                <span className="text-[9px] font-bold tracking-widest uppercase">{label}</span>
            </button>
        );

        // --- START ---
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
