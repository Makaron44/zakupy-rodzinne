<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <title>Nawigator Rzeczywisto≈õci</title>

    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3242/3242257.png">
    <link rel="manifest" href="manifest.json">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* FIX PWA: Dodatkowy padding na dole body, ≈ºeby tre≈õƒá nie chowa≈Ça siƒô pod menu */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f172a; 
            color: #f8fafc; 
            -webkit-tap-highlight-color: transparent; 
            overscroll-behavior-y: none; 
            padding-bottom: calc(85px + env(safe-area-inset-bottom)); /* Kluczowe dla PWA */
        }
        
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .safe-top { padding-top: max(1rem, env(safe-area-inset-top)); }
        
        input, textarea, select { font-size: 16px !important; background: rgba(15, 23, 42, 0.6); color: white; border: 1px solid #334155; outline: none; }
        input:focus, textarea:focus, select:focus { border-color: #a855f7; }
        
        /* Animacja Oddechu */
        .breathe-container { height: 140px; display: flex; align-items: center; justify-content: center; position: relative; margin-bottom: 10px; }
        .breathe-circle { width: 60px; height: 60px; border-radius: 50%; background: radial-gradient(circle, rgba(168,85,247,0.4) 0%, rgba(168,85,247,0) 70%); border: 2px solid rgba(168,85,247,0.5); box-shadow: 0 0 20px rgba(168,85,247,0.3); animation: breathe 10s infinite ease-in-out; }
        @keyframes breathe { 
            0%, 100% { transform: scale(1); opacity: 0.5; box-shadow: 0 0 10px rgba(168,85,247,0.2); } 
            50% { transform: scale(1.8); opacity: 1; box-shadow: 0 0 30px rgba(168,85,247,0.6); border-color: #d8b4fe; } 
        }

        .view-section { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .view-section.active { display: block; opacity: 1; }
        
        /* Modal Generalny (Domy≈õlnie na dole - szuflada) */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(4px); z-index: 100; align-items: flex-end; justify-content: center; }
        .modal-overlay.open { display: flex; animation: fadeIn 0.2s ease-out; }
        
        /* Modal Wy≈õrodkowany (Dla Pere≈Çek) */
        .modal-overlay.center-modal { align-items: center; } 

        /* Zawarto≈õƒá Modala Formularza (Szuflada z do≈Çu) */
        .modal-content { width: 100%; max-width: 480px; border-radius: 2rem 2rem 0 0; padding: 1.5rem; background: #1e293b; border-top: 1px solid rgba(255,255,255,0.1); animation: slideUp 0.3s ease-out; max-height: 85vh; overflow-y: auto; }
        
        /* Animacja pulsujƒÖcego obramowania dla ≈õrodkowego modala */
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(168, 85, 247, 0.1), 0 0 10px rgba(236, 72, 153, 0.1); border-color: rgba(255, 255, 255, 0.1); }
            50% { box-shadow: 0 0 25px rgba(168, 85, 247, 0.4), 0 0 35px rgba(236, 72, 153, 0.4); border-color: rgba(168, 85, 247, 0.5); }
        }

        /* Zawarto≈õƒá Modala Pere≈Çki (Wy≈õrodkowane okno z pulsowaniem) */
        .modal-view-content { 
            width: 90%; 
            max-width: 400px; 
            background: #1e293b; 
            border-radius: 1.5rem; 
            padding: 1.5rem; 
            /* Po≈ÇƒÖczenie animacji pojawiania siƒô i pulsowania */
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), pulseGlow 3s infinite ease-in-out;
            border: 1px solid rgba(255,255,255,0.1);
        }

        #toast-container { position: fixed; top: 20px; left: 0; right: 0; display: flex; justify-content: center; pointer-events: none; z-index: 9999; }
        .toast { background: #10b981; color: white; padding: 10px 20px; border-radius: 99px; font-weight: 600; font-size: 14px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); animation: popIn 0.3s; pointer-events: auto; display: flex; align-items: center; gap: 8px; }
        .toast.error { background: #ef4444; }
        
        /* Dziennik */
        .tag-btn { padding: 6px 12px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); font-size: 11px; background: rgba(255,255,255,0.05); color: #cbd5e1; transition: all 0.2s; }
        .tag-btn.selected { background: #3b82f6; border-color: #3b82f6; color: white; }
        
        .status-btn { flex: 1; padding: 12px; border-radius: 12px; border: 2px solid transparent; font-weight: bold; font-size: 12px; text-align: center; transition: all 0.2s; background: rgba(255,255,255,0.05); color: #64748b; }
        .status-btn.fed.active { background: rgba(239,68,68,0.2); border-color: #ef4444; color: #ef4444; }
        .status-btn.ext.active { background: rgba(16,185,129,0.2); border-color: #10b981; color: #10b981; }

        /* FIX NAWIGACJI - BETONOWANIE DLA PWA */
        .fixed-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            /* Sta≈Ça wysoko≈õƒá tre≈õci (65px) + bezpieczna strefa na dole */
            height: calc(65px + env(safe-area-inset-bottom));
            padding-bottom: env(safe-area-inset-bottom);
            background: rgba(15, 23, 42, 0.95); /* Ciemniejsze t≈Ço ≈ºeby nie prze≈õwitywa≈Ço */
            backdrop-filter: blur(16px);
            z-index: 50;
            display: flex;
            justify-content: space-between;
            align-items: flex-start; /* Elementy od g√≥ry kontenera */
            padding-top: 10px; /* Odstƒôp od g√≥ry paska */
            border-top: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
        }
        
        .nav-btn-fixed {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 45px; /* Wysoko≈õƒá samego przycisku wewnƒÖtrz paska */
        }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="safe-top">

    <div id="toast-container"></div>
    <div id="debug-console"></div>

    <header class="px-6 py-4 flex justify-between items-center sticky top-0 z-30 backdrop-blur-md bg-[#0f172a]/80">
        <div>
            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">Nawigator</h1>
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest italic">Transerfing Rzeczywisto≈õci</p>
        </div>
        <button onclick="switchTab('settings')" class="p-3 glass rounded-2xl transition-all active:scale-95">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>
    </header>

    <main id="app-content" class="px-4 space-y-6">
        
        <div id="tab-dashboard" class="view-section active">
            <section class="space-y-3">
                <h2 class="text-sm font-bold text-purple-400 px-1">Twoje Nastawienie</h2>
                <div class="glass rounded-3xl p-6 bg-gradient-to-br from-purple-900/20 to-slate-900 border-purple-500/20">
                    <div id="amalgam-display" class="hidden text-center space-y-4">
                        <p class="text-xl font-medium italic text-slate-100" id="amalgam-text"></p>
                        <button onclick="speakAmalgam()" class="flex items-center justify-center gap-2 mx-auto bg-purple-600/20 hover:bg-purple-600/40 text-purple-300 px-4 py-2 rounded-full text-xs font-bold transition-colors">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                            ODS≈ÅUCHAJ
                        </button>
                        <button onclick="resetAmalgam()" class="text-xs text-slate-500 underline block mx-auto mt-2">Ustaw nowy cel</button>
                    </div>
                    <div id="amalgam-form" class="space-y-4">
                        <p class="text-xs text-slate-400">Co Ciƒô dzi≈õ stresuje?</p>
                        <div class="flex gap-2">
                            <input type="text" id="challenge-input" placeholder="Wpisz problem..." class="flex-1 rounded-2xl px-4 py-3">
                            <button onclick="generateAmalgam()" id="btn-generate" class="bg-purple-600 p-3 rounded-2xl text-white active:scale-95">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="space-y-3">
                <h2 class="text-sm font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-purple-400 px-1">Koherencja Serca</h2>
                <div class="glass rounded-3xl p-6 flex flex-col items-center justify-center gap-4 border-slate-700/50">
                    <div class="breathe-container"><div class="breathe-circle"></div></div>
                    <p class="text-[10px] text-slate-500 uppercase tracking-widest text-center mt-2">Wdech ‚Ä¢ Spok√≥j ‚Ä¢ Wydech</p>
                </div>
            </section>

            <section class="space-y-3">
                <div class="flex justify-between items-center px-1">
                    <h2 class="text-sm font-bold text-red-400">SOS</h2>
                    <button onclick="openModal('pearl', 'üö® SOS')" class="text-slate-400 p-2"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg></button>
                </div>
                <div id="sos-container" class="space-y-3"></div>
            </section>
        </div>

        <div id="tab-wiedza" class="view-section">
            <div class="flex flex-col gap-4 mb-4">
                <div class="flex justify-between items-center px-1">
                    <h2 class="text-xl font-bold text-blue-400">Baza Wiedzy</h2>
                    <button onclick="openModal('pearl', 'üß† ZASADA')" class="bg-blue-600 p-3 rounded-full text-white shadow-lg active:scale-90"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg></button>
                </div>
                <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar" id="filter-bar"></div>
            </div>
            <div id="wiedza-container" class="space-y-4 pb-20"></div>
        </div>

        <div id="tab-dziennik" class="view-section">
            <div class="flex justify-between items-center px-1 mb-4">
                <h2 class="text-xl font-bold text-emerald-400">Dziennik</h2>
                <button onclick="openModal('journal')" class="bg-emerald-600 p-3 rounded-full text-white shadow-lg active:scale-90"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="8" x2="12" y2="16"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
            </div>
            <div class="glass rounded-2xl p-4 flex items-center gap-2 mb-4">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" id="journal-search" oninput="renderJournal()" placeholder="Szukaj..." class="bg-transparent border-none w-full p-0">
            </div>
            <div id="journal-container" class="space-y-4 pb-20"></div>
        </div>

        <div id="tab-analiza" class="view-section">
            <h2 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 mb-4 px-1">Trend Energii</h2>
            <div class="glass rounded-3xl p-6 h-72 border-purple-500/10 relative overflow-hidden bg-[#161e31]">
                <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5"></div>
                <div id="chart-container" class="w-full h-full relative z-10"></div>
            </div>
             <p class="text-center text-[10px] text-slate-500 mt-4">Ostatnie 7 dni aktywno≈õci</p>
        </div>

        <div id="tab-settings" class="view-section">
            <h2 class="text-xl font-bold mb-4 px-1">Ustawienia</h2>
            
            <div class="glass rounded-3xl p-6 space-y-4 border border-blue-500/20 mb-4">
                <div class="flex items-center gap-3 mb-2">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg>
                    <h3 class="text-sm font-bold text-slate-200">Klucz API Gemini</h3>
                </div>
                <input type="password" id="api-key-input" onchange="saveApiKey()" placeholder="Wklej klucz API..." class="w-full rounded-xl p-4 font-mono text-xs bg-slate-800">
            </div>

            <div class="glass rounded-3xl p-6 space-y-4 border border-emerald-500/20 mb-4">
                <h3 class="text-sm font-bold text-slate-200">Kopia Zapasowa</h3>
                <div class="flex gap-2">
                    <button onclick="downloadBackup()" class="flex-1 py-3 bg-slate-800 rounded-xl text-xs font-bold text-emerald-400 border border-emerald-500/30">POBIERZ</button>
                    <label class="flex-1 py-3 bg-slate-800 rounded-xl text-xs font-bold text-blue-400 border border-blue-500/30 text-center cursor-pointer">
                        WGRAJ
                        <input type="file" onchange="uploadBackup(this)" class="hidden" accept=".json">
                    </label>
                </div>
            </div>

            <button onclick="hardReset()" class="w-full py-4 mt-6 glass text-red-400 rounded-2xl font-bold border-red-500/20">RESET DANYCH</button>
        </div>
    </main>

    <nav class="fixed-nav px-6">
        <button onclick="switchTab('dashboard')" class="nav-btn nav-btn-fixed text-blue-400 active:scale-95 transition-transform" data-target="dashboard">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            <span class="text-[10px] font-bold">Dzi≈õ</span>
        </button>
        <button onclick="switchTab('wiedza')" class="nav-btn nav-btn-fixed text-slate-500 active:scale-95 transition-transform" data-target="wiedza">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
            <span class="text-[10px] font-bold">Wiedza</span>
        </button>
        <button onclick="switchTab('dziennik')" class="nav-btn nav-btn-fixed text-slate-500 active:scale-95 transition-transform" data-target="dziennik">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
            <span class="text-[10px] font-bold">Dziennik</span>
        </button>
        <button onclick="switchTab('analiza')" class="nav-btn nav-btn-fixed text-slate-500 active:scale-95 transition-transform" data-target="analiza">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
            <span class="text-[10px] font-bold">Analiza</span>
        </button>
    </nav>

    <div id="modal-view-pearl" class="modal-overlay center-modal" onclick="handleModalClick(event, 'view-pearl')">
        <div class="modal-view-content glass flex flex-col gap-4 text-center">
            <div id="view-icon" class="mx-auto p-4 rounded-full bg-slate-800 mb-2 w-fit"></div>
            <h3 id="view-title" class="text-2xl font-bold text-white leading-tight"></h3>
            <p id="view-desc" class="text-slate-300 text-sm leading-relaxed mt-2"></p>
            <div class="border-t border-white/10 pt-4 mt-2">
                <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-2">Afirmacja</p>
                <p id="view-affirm" class="text-lg font-bold text-emerald-400 leading-snug"></p>
            </div>
            <button onclick="closeModal('view-pearl')" class="mt-4 py-3 w-full bg-slate-800 rounded-xl text-slate-400 font-bold text-xs">ZAMKNIJ</button>
        </div>
    </div>

    <div id="modal-pearl" class="modal-overlay" onclick="handleModalClick(event, 'pearl')">
        <div class="modal-content glass">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-blue-400 text-lg">Nowa Pere≈Çka</h3>
                <button onclick="closeModal('pearl')" class="p-2 text-slate-400"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
            </div>
            <div class="space-y-4">
                <select id="p-cat" class="w-full rounded-2xl p-4">
                    <option value="üö® SOS">üö® SOS</option>
                    <option value="üé• SLAJD">üé• SLAJD</option>
                    <option value="üß† ZASADA">üß† ZASADA</option>
                </select>
                <input id="p-title" placeholder="Tytu≈Ç..." class="w-full rounded-2xl p-4">
                <textarea id="p-desc" placeholder="Tre≈õƒá..." class="w-full rounded-2xl p-4 h-24"></textarea>
                <input id="p-affirm" placeholder="Afirmacja..." class="w-full rounded-2xl p-4">
                <button type="button" onclick="addPearl()" class="w-full py-4 bg-blue-600 rounded-2xl font-bold text-white shadow-lg">ZAPISZ</button>
            </div>
        </div>
    </div>

    <div id="modal-journal" class="modal-overlay" onclick="handleModalClick(event, 'journal')">
        <div class="modal-content glass">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-emerald-400 text-lg">Nowy Wpis</h3>
                <button onclick="closeModal('journal')" class="p-2 text-slate-400"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
            </div>
            <div class="space-y-5">
                <div>
                    <label class="text-xs text-slate-500 ml-2 mb-2 block uppercase tracking-wider">Wynik starcia z Wahad≈Çem</label>
                    <div class="flex gap-2">
                        <button type="button" id="status-fed" onclick="setPendulumStatus('fed')" class="status-btn fed">üî¥ Nakarmione</button>
                        <button type="button" id="status-ext" onclick="setPendulumStatus('ext')" class="status-btn ext">üü¢ Wygaszone</button>
                    </div>
                    <input type="hidden" id="j-status" value="">
                </div>

                <div>
                    <label class="text-xs text-slate-500 ml-2 mb-1 block">Twoja Energia (1-5)</label>
                    <input id="j-energy" type="range" min="1" max="5" value="3" class="w-full accent-emerald-500 h-2 bg-slate-700 rounded-lg appearance-none">
                    <div class="flex justify-between text-[10px] text-slate-500 px-1"><span>Niska</span><span>Wysoka</span></div>
                </div>

                <select id="j-hook" class="w-full rounded-2xl p-4">
                    <option>Aplikacja Paliwowa</option><option>Szef</option><option>Korek</option>
                    <option>Lƒôk</option><option>Inny Kierowca</option><option>Zmƒôczenie</option><option>Inne</option>
                </select>

                <div>
                    <label class="text-xs text-slate-500 ml-2 mb-2 block">Co czu≈Çe≈õ? (Tagi)</label>
                    <div class="flex flex-wrap gap-2" id="tags-container">
                        <button onclick="toggleTag(this)" class="tag-btn">üò° Z≈Ço≈õƒá</button>
                        <button onclick="toggleTag(this)" class="tag-btn">üò® Lƒôk</button>
                        <button onclick="toggleTag(this)" class="tag-btn">üò© Zmƒôczenie</button>
                        <button onclick="toggleTag(this)" class="tag-btn">üòê Obojƒôtno≈õƒá</button>
                        <button onclick="toggleTag(this)" class="tag-btn">üòÇ ≈ömiech</button>
                        <button onclick="toggleTag(this)" class="tag-btn">üòå Spok√≥j</button>
                    </div>
                </div>

                <textarea id="j-concl" placeholder="Wniosek (Lekcja na przysz≈Ço≈õƒá)..." class="w-full rounded-2xl p-4 h-20 text-sm"></textarea>
                
                <button type="button" onclick="addJournal()" class="w-full py-4 bg-emerald-600 rounded-2xl font-bold text-white shadow-lg mt-2">DODAJ WPIS</button>
            </div>
        </div>
    </div>

    <script>
        function logError(msg) { console.error(msg); }
        window.onerror = function(msg, url, line) { if(!msg.includes('ResizeObserver')) console.error(msg); };

        // --- STATE ---
        const INITIAL_PEARLS = [
            { id: "1", kategoria: "üö® SOS", tytul: "Presja Czasu", trescPorady: "Zejd≈∫ z linii ciosu. To tylko cyfry.", afirmacjaSkrot: "M√≥j ≈õwiat dba o m√≥j spok√≥j." },
            { id: "2", kategoria: "üé• SLAJD", tytul: "Bezpieczna Trasa", trescPorady: "Widzisz zielone ≈õwiat≈Ça i pustƒÖ drogƒô.", afirmacjaSkrot: "P≈Çynƒô w PrƒÖdzie Wariant√≥w." }
        ];

        let state = { pearls: [], journal: [], amalgam: "", apiKey: "", filter: 'ALL' };
        let currentTags = []; // Tagi dla nowego wpisu

        function loadState() {
            try {
                state.pearls = JSON.parse(localStorage.getItem('nr_pearls')) || INITIAL_PEARLS;
                state.journal = JSON.parse(localStorage.getItem('nr_journal')) || [];
                state.amalgam = localStorage.getItem('nr_amalgam') || "";
                state.apiKey = localStorage.getItem('nr_api_key') || "";
            } catch (e) { state.pearls = INITIAL_PEARLS; }
        }
        loadState();

        function save() {
            try {
                localStorage.setItem('nr_pearls', JSON.stringify(state.pearls));
                localStorage.setItem('nr_journal', JSON.stringify(state.journal));
                localStorage.setItem('nr_amalgam', state.amalgam);
                localStorage.setItem('nr_api_key', state.apiKey);
            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    if(confirm("B≈ÇƒÖd pamiƒôci! Wyczy≈õciƒá dane?")) { localStorage.clear(); location.reload(); }
                }
            }
        }

        // --- FILTER ---
        function setFilter(category) { state.filter = category; renderWiedza(); }

        // --- MODAL VIEW ---
        function viewPearl(id) {
            const pearl = state.pearls.find(p => p.id === id);
            if (!pearl) return;
            document.getElementById('view-title').textContent = pearl.tytul;
            document.getElementById('view-desc').textContent = `"${pearl.trescPorady}"`;
            document.getElementById('view-affirm').textContent = pearl.afirmacjaSkrot;
            
            const iconContainer = document.getElementById('view-icon');
            let color = "text-blue-400";
            let iconSvg = "";
            if(pearl.kategoria.includes("SOS")) {
                color = "text-red-400";
                iconSvg = '<svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>';
            } else if (pearl.kategoria.includes("SLAJD")) {
                color = "text-purple-400";
                iconSvg = '<svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>';
            } else {
                color = "text-blue-400";
                iconSvg = '<svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>';
            }
            iconContainer.innerHTML = iconSvg;
            iconContainer.className = `mx-auto p-4 rounded-full bg-slate-800 mb-2 w-fit ${color}`;
            openModal('view-pearl');
        }

        // --- JOURNAL LOGIC ---
        function setPendulumStatus(status) {
            document.getElementById('j-status').value = status;
            document.getElementById('status-fed').classList.remove('active');
            document.getElementById('status-ext').classList.remove('active');
            document.getElementById(`status-${status}`).classList.add('active');
        }

        function toggleTag(btn) {
            btn.classList.toggle('selected');
            const text = btn.textContent;
            if(btn.classList.contains('selected')) {
                currentTags.push(text);
            } else {
                currentTags = currentTags.filter(t => t !== text);
            }
        }

        // --- RENDER VIEWS ---
        function renderDashboard() {
            const display = document.getElementById('amalgam-display');
            const form = document.getElementById('amalgam-form');
            if (state.amalgam) {
                display.classList.remove('hidden'); form.classList.add('hidden');
                document.getElementById('amalgam-text').textContent = `"${state.amalgam}"`;
            } else {
                display.classList.add('hidden'); form.classList.remove('hidden');
            }
            const container = document.getElementById('sos-container');
            container.innerHTML = '';
            const items = state.pearls.filter(p => p.kategoria === "üö® SOS");
            if(items.length === 0) container.innerHTML = '<p class="text-xs text-slate-500 text-center py-4">Brak wpis√≥w SOS.</p>';
            items.forEach(p => {
                container.innerHTML += `
                    <div onclick="viewPearl('${p.id}')" class="glass rounded-2xl p-4 border-l-4 border-red-500 flex justify-between items-center mb-3 active:scale-95 transition-transform cursor-pointer relative overflow-hidden">
                        <div class="flex-1 pr-4 pointer-events-none"><h3 class="font-bold text-sm mb-1 text-slate-200">${p.tytul}</h3><p class="text-xs text-slate-400 italic">"${p.trescPorady}"</p></div>
                        <button onclick="deletePearl(event, '${p.id}')" class="p-3 text-slate-500 hover:text-red-400 bg-slate-800/50 rounded-xl z-20 pointer-events-auto"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>
                    </div>`;
            });
        }

        function renderWiedza() {
            const filterBar = document.getElementById('filter-bar');
            const filters = [{ id: 'ALL', label: 'Wszystkie' }, { id: 'üö® SOS', label: 'SOS' }, { id: 'üé• SLAJD', label: 'Slajd' }, { id: 'üß† ZASADA', label: 'Zasada' }];
            filterBar.innerHTML = filters.map(f => `<button onclick="setFilter('${f.id}')" class="filter-btn ${state.filter === f.id ? 'active' : 'inactive'}">${f.label}</button>`).join('');

            const container = document.getElementById('wiedza-container');
            container.innerHTML = '';
            let filteredPearls = state.pearls;
            if (state.filter !== 'ALL') filteredPearls = state.pearls.filter(p => p.kategoria === state.filter);
            if(filteredPearls.length === 0) container.innerHTML = '<p class="text-center text-slate-500 mt-10">Pusto.</p>';
            filteredPearls.forEach(p => {
                let color = 'text-blue-400', border = 'border-blue-500/20', bg = 'bg-blue-500/5';
                if(p.kategoria === "üö® SOS") { color = 'text-red-400'; border = 'border-red-500/20'; bg = 'bg-red-500/5'; }
                if(p.kategoria === "üé• SLAJD") { color = 'text-purple-400'; border = 'border-purple-500/20'; bg = 'bg-purple-500/5'; }
                container.innerHTML += `
                    <div class="glass rounded-2xl p-5 border ${border} ${bg} flex justify-between items-start gap-4 mb-4">
                        <div class="flex-1">
                            <p class="text-[10px] font-bold uppercase tracking-wider ${color} mb-2">${p.kategoria}</p>
                            <h3 class="font-bold text-lg text-slate-100">${p.tytul}</h3>
                            <p class="text-sm text-slate-400 mt-2 font-light">"${p.trescPorady}"</p>
                            <div class="mt-3 pt-3 border-t border-white/5"><p class="text-[10px] text-slate-500 uppercase">Afirmacja</p><p class="text-xs font-bold text-emerald-400 uppercase">${p.afirmacjaSkrot}</p></div>
                        </div>
                        <button onclick="deletePearl(event, '${p.id}')" class="p-2 text-slate-500 hover:text-red-400 active:scale-95"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>
                    </div>`;
            });
        }

        function renderJournal() {
            const container = document.getElementById('journal-container');
            const searchVal = document.getElementById('journal-search').value.toLowerCase();
            container.innerHTML = '';
            const filtered = state.journal.filter(j => j.haczyk.toLowerCase().includes(searchVal));
            if(filtered.length === 0) { container.innerHTML = '<p class="text-center text-slate-600 mt-10">Brak wpis√≥w.</p>'; return; }
            
            filtered.forEach(j => {
                let borderColor = 'border-slate-500/50';
                let statusIcon = '';
                if(j.status === 'fed') { borderColor = 'border-red-500'; statusIcon = 'üî¥'; }
                if(j.status === 'ext') { borderColor = 'border-emerald-500'; statusIcon = 'üü¢'; }

                const tagsHtml = j.tags ? j.tags.map(t => `<span class="text-[9px] px-2 py-1 rounded-full bg-white/10 text-slate-300">${t}</span>`).join('') : '';

                container.innerHTML += `
                    <div class="glass rounded-2xl p-4 border-l-4 ${borderColor} space-y-3 mb-4">
                        <div class="flex justify-between items-center text-[10px] text-slate-500 border-b border-white/5 pb-2">
                            <span>${new Date(j.timestamp).toLocaleString('pl-PL')}</span>
                            <div class="flex items-center gap-2">
                                <span>${statusIcon}</span>
                                <span class="font-bold text-emerald-400">Energia: ${j.energia}/5</span>
                            </div>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500 uppercase tracking-widest mb-1">Haczyk</p>
                            <p class="text-base font-bold text-slate-200">${j.haczyk}</p>
                        </div>
                        
                        ${tagsHtml ? `<div class="flex flex-wrap gap-1">${tagsHtml}</div>` : ''}
                        
                        ${j.wniosek ? `
                        <div class="pt-2 border-t border-white/5 flex justify-between items-end">
                            <div class="flex-1">
                                <p class="text-[10px] text-blue-400/80 uppercase mb-1">Wniosek</p>
                                <p class="text-xs text-blue-300 italic">"${j.wniosek}"</p>
                            </div>
                            <button onclick="deleteJournal('${j.id}')" class="ml-2 text-slate-600 hover:text-red-400 active:scale-95"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>
                        </div>` : ''}
                    </div>`;
            });
        }

        // --- UTILS ---
        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(el => {
                const target = el.dataset.target;
                el.classList.remove('text-blue-400', 'text-emerald-400', 'text-purple-400', 'text-slate-500');
                if(target === tabId) {
                    if(tabId === 'dziennik') el.classList.add('text-emerald-400');
                    else if(tabId === 'analiza') el.classList.add('text-purple-400');
                    else el.classList.add('text-blue-400');
                } else el.classList.add('text-slate-500');
            });
            refreshAllViews();
        }

        function refreshAllViews() { renderDashboard(); renderWiedza(); renderJournal(); renderChart(); }
        
        function showToast(msg, isError=false) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast' + (isError ? ' error' : '');
            toast.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg> ${msg}`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
        }

        // --- ACTIONS ---
        function addPearl() {
            try {
                const title = document.getElementById('p-title').value;
                if(!title) { alert('Wpisz tytu≈Ç!'); return; }
                const newP = { id: Date.now().toString(), kategoria: document.getElementById('p-cat').value, tytul: title, trescPorady: document.getElementById('p-desc').value, afirmacjaSkrot: document.getElementById('p-affirm').value };
                state.pearls.unshift(newP); save();
                document.getElementById('p-title').value = ""; document.getElementById('p-desc').value = ""; document.getElementById('p-affirm').value = "";
                closeModal('pearl'); refreshAllViews(); showToast('Dodano pere≈Çkƒô!');
            } catch(e) { logError(e.message); }
        }
        function deletePearl(e, id) { 
            e.stopPropagation(); 
            if(confirm('Na pewno usunƒÖƒá?')) { state.pearls = state.pearls.filter(p => p.id !== id); save(); refreshAllViews(); showToast('Usuniƒôto pere≈Çkƒô.'); }
        }

        function addJournal() {
            try {
                const status = document.getElementById('j-status').value;
                const newJ = { 
                    id: Date.now().toString(), 
                    timestamp: Date.now(), 
                    energia: Number(document.getElementById('j-energy').value), 
                    haczyk: document.getElementById('j-hook').value, 
                    wniosek: document.getElementById('j-concl').value,
                    status: status, 
                    tags: [...currentTags]
                };
                
                state.journal.unshift(newJ); 
                save();
                
                document.getElementById('j-concl').value = "";
                document.getElementById('j-status').value = "";
                currentTags = [];
                document.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('selected'));
                document.querySelectorAll('.status-btn').forEach(b => b.classList.remove('active'));

                closeModal('journal'); refreshAllViews(); showToast('Dodano wpis!');
            } catch(e) { logError(e.message); }
        }
        function deleteJournal(id) { if(confirm('UsunƒÖƒá ten wpis?')) { state.journal = state.journal.filter(j => j.id !== id); save(); refreshAllViews(); showToast('Usuniƒôto wpis.'); }}

        function openModal(modalName, defCat = null) {
            const modal = document.getElementById(`modal-${modalName}`);
            modal.classList.add('open');
            if (modalName === 'pearl' && defCat) document.getElementById('p-cat').value = defCat;
        }
        function closeModal(name) { document.getElementById(`modal-${name}`).classList.remove('open'); }
        function handleModalClick(e, name) { if(e.target === document.getElementById(`modal-${name}`)) closeModal(name); }

        // --- BACKUP & OTHER ---
        function downloadBackup() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "nawigator_backup_" + new Date().toISOString().slice(0,10) + ".json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function uploadBackup(input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const loadedState = JSON.parse(e.target.result);
                    if(loadedState.pearls && loadedState.journal) {
                        state = loadedState;
                        save();
                        refreshAllViews();
                        showToast('Wgrano kopiƒô zapasowƒÖ!');
                    } else { alert("Nieprawid≈Çowy plik!"); }
                } catch(err) { alert("B≈ÇƒÖd pliku: " + err.message); }
            };
            reader.readAsText(file);
        }

        function saveApiKey() { state.apiKey = document.getElementById('api-key-input').value; save(); showToast('Zapisano klucz API'); }
        function hardReset() { if(confirm("UsunƒÖƒá wszystko?")) { localStorage.clear(); location.reload(); }}
        
        function speakAmalgam() {
            if(!state.amalgam) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(state.amalgam);
            utterance.lang = 'pl-PL';
            const voices = window.speechSynthesis.getVoices();
            const polishVoice = voices.find(v => v.lang.includes('pl') || v.lang === 'pl-PL');
            if (polishVoice) utterance.voice = polishVoice;
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            window.speechSynthesis.speak(utterance);
        }
        window.speechSynthesis.onvoiceschanged = () => { console.log("G≈Çosy za≈Çadowane."); };

        function getSmoothPath(points, height, padding) {
            if (points.length === 0) return "";
            if (points.length === 1) return `M ${points[0].x} ${points[0].y}`;
            let path = `M ${points[0].x} ${points[0].y}`;
            for (let i = 0; i < points.length - 1; i++) {
                const p0 = points[i === 0 ? 0 : i - 1];
                const p1 = points[i];
                const p2 = points[i + 1];
                const p3 = points[i + 2] || p2;
                const cp1x = p1.x + (p2.x - p0.x) / 6;
                const cp1y = p1.y + (p2.y - p0.y) / 6;
                const cp2x = p2.x - (p3.x - p1.x) / 6;
                const cp2y = p2.y - (p3.y - p1.y) / 6;
                path += ` C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${p2.x} ${p2.y}`;
            }
            return path;
        }

        function renderChart() {
            const container = document.getElementById('chart-container');
            if (state.journal.length === 0) {
                container.innerHTML = '<div class="h-full flex items-center justify-center text-slate-500 text-xs">Brak danych</div>';
                return;
            }
            const dataPoints = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                const dateStr = d.toLocaleDateString('pl-PL', { day: '2-digit', month: '2-digit' });
                const entries = state.journal.filter(j => new Date(j.timestamp).toLocaleDateString('pl-PL', { day: '2-digit', month: '2-digit' }) === dateStr);
                const avg = entries.length ? entries.reduce((s, c) => s + c.energia, 0) / entries.length : 0;
                dataPoints.push({ date: dateStr, val: avg });
            }
            const h = container.clientHeight || 200;
            const w = container.clientWidth || 300;
            const pad = 30; const max = 5;
            const coords = dataPoints.map((d, i) => ({ x: pad + (i / (dataPoints.length - 1 || 1)) * (w - 2 * pad), y: h - pad - (d.val / max) * (h - 2 * pad), val: d.val, label: d.date.split('.')[0] }));
            const linePath = getSmoothPath(coords, h, pad);
            const areaPath = `${linePath} L ${w-pad} ${h-pad} L ${pad} ${h-pad} Z`;
            const gridLines = [1, 2, 3, 4, 5].map(v => { const y = h - pad - (v / max) * (h - 2 * pad); return `<line x1="${pad}" y1="${y}" x2="${w-pad}" y2="${y}" stroke="#334155" stroke-width="1" stroke-dasharray="4" opacity="0.3" /><text x="${pad-10}" y="${y+3}" fill="#64748b" font-size="9" text-anchor="end">${v}</text>`; }).join('');
            const dots = coords.map(p => { if(p.val === 0) return `<text x="${p.x}" y="${h-10}" fill="#64748b" font-size="9" text-anchor="middle">${p.label}</text>`; return `<g><circle cx="${p.x}" cy="${p.y}" r="6" fill="#0f172a" stroke="#a855f7" stroke-width="2" /><circle cx="${p.x}" cy="${p.y}" r="3" fill="#fff" /><text x="${p.x}" y="${h-10}" fill="#94a3b8" font-size="10" text-anchor="middle" font-weight="bold">${p.label}</text></g>`; }).join('');
            container.innerHTML = `<svg viewBox="0 0 ${w} ${h}" class="w-full h-full overflow-visible"><defs><linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#a855f7" stop-opacity="0.5" /><stop offset="100%" stop-color="#a855f7" stop-opacity="0" /></linearGradient><filter id="glow"><feGaussianBlur stdDeviation="2.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs>${gridLines}<path d="${areaPath}" fill="url(#grad1)" /><path d="${linePath}" fill="none" stroke="#d8b4fe" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" filter="url(#glow)" />${dots}</svg>`;
        }

        function resetAmalgam() { state.amalgam = ""; save(); renderDashboard(); }

        // --- API CALL (GEMINI 2.5 FLASH) ---
        async function generateAmalgam() {
            const problem = document.getElementById('challenge-input').value;
            if(!problem) return;
            if(!state.apiKey) { alert('Podaj klucz API w ustawieniach!'); switchTab('settings'); return; }
            
            const btn = document.getElementById('btn-generate');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '...'; btn.disabled = true;
            
            try {
                const requestBody = {
                    contents: [{ parts: [{ text: `Jeste≈õ Vadimem Zelandem. Kr√≥tka (1 zdanie), mocna afirmacja dla kierowcy ciƒô≈ºar√≥wki na problem: "${problem}".` }] }],
                    safetySettings: [
                        { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                        { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
                    ]
                };

                // U≈ªYWAMY MODELU 2.5 FLASH
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${state.apiKey}`, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify(requestBody) 
                });
                
                if (!response.ok) {
                    const err = await response.json();
                    if(response.status === 429) throw new Error("Limit zapyta≈Ñ wyczerpany. Spr√≥buj p√≥≈∫niej.");
                    throw new Error("B≈ÇƒÖd API: " + (err.error?.message || response.statusText));
                }

                const data = await response.json();
                if (!data.candidates || data.candidates.length === 0) throw new Error("AI nie zwr√≥ci≈Ço odpowiedzi.");

                state.amalgam = data.candidates[0].content.parts[0].text;
                save(); 
                document.getElementById('challenge-input').value = ''; 
                renderDashboard(); 
                showToast('Gotowe!');
            } catch(e) { 
                showToast(e.message, true); 
            }
            btn.innerHTML = originalHTML; btn.disabled = false;
        }

        window.onload = () => { document.getElementById('api-key-input').value = state.apiKey; switchTab('dashboard'); setTimeout(renderChart, 100); };
    </script>
</body>
</html>
